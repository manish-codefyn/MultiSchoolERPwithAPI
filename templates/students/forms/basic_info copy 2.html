{% extends 'layouts/dashboard.html' %}
{% load static %}
{% load i18n %}
{% load crispy_forms_tags %}

{% block title %}{% trans "Basic Information" %} - {% trans "Student Onboarding" %}{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="h3 mb-0 text-gray-800">{% trans "Basic Information" %}</h1>
            <p class="text-muted mb-0">{% trans "Step 1: Student Personal Details" %}</p>
        </div>
        <div>
            {% if object %}
            <a href="{% url 'students:student_onboarding' pk=object.pk %}" class="btn btn-outline-secondary">
                <i class="bx bx-left me-2"></i>{% trans "Back to Onboarding" %}
            </a>
            {% else %}
            <a href="{% url 'students:student_list' %}" class="btn btn-outline-secondary">
                <i class="bx bx-left me-2"></i>{% trans "Cancel" %}
            </a>
            {% endif %}
        </div>
    </div>

    <div class="card shadow mb-4">
        <div class="card-body">
            <form method="post" enctype="multipart/form-data" id="studentForm">
                {% csrf_token %}
               
                <!-- Academic Details -->
                <h6 class="text-primary mb-3">Academic Details</h6>
                <div class="row row-cols-1 row-cols-md-3 g-3 mb-4">
                    <div class="col">{{ form.academic_year|as_crispy_field }}</div>
                    <div class="col">{{ form.current_class|as_crispy_field }}</div>
                    <div class="col">{{ form.section|as_crispy_field }}</div>
                    <div class="col">{{ form.admission_type|as_crispy_field }}</div>
                </div>

                <hr>

                <!-- Personal Details -->
                <h6 class="text-primary mb-3">Personal Details</h6>
                <div class="row row-cols-1 row-cols-md-3 g-3 mb-4">
                    <div class="col">{{ form.first_name|as_crispy_field }}</div>
                    <div class="col">{{ form.middle_name|as_crispy_field }}</div>
                    <div class="col">{{ form.last_name|as_crispy_field }}</div>
                    <div class="col">{{ form.date_of_birth|as_crispy_field }}</div>
                    <div class="col">{{ form.gender|as_crispy_field }}</div>
                    <div class="col">{{ form.blood_group|as_crispy_field }}</div>
                    <div class="col">{{ form.category|as_crispy_field }}</div>
                    <div class="col">{{ form.religion|as_crispy_field }}</div>
                    <div class="col">{{ form.nationality|as_crispy_field }}</div>
                </div>

                <hr>

                <!-- Contact Details -->
                <h6 class="text-primary mb-3">Contact Details</h6>
                <div class="row row-cols-1 row-cols-md-3 g-3">
                    <div class="col">{{ form.personal_email|as_crispy_field }}</div>
                    <div class="col">{{ form.mobile_primary|as_crispy_field }}</div>
                    <div class="col">{{ form.mobile_secondary|as_crispy_field }}</div>
                </div>

                <div class="d-flex justify-content-end mt-4">
                    <button type="submit" class="btn btn-primary">
                        <i class="bx bx-save me-2"></i>{% trans "Save & Continue" %}
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

{% block extra_js %}
<script>
    $(document).ready(function() {
        // Initialize Select2
        $('.select2').select2({
            theme: 'bootstrap-5',
            width: '100%'
        });

        // Dependent dropdown: Class -> Section
        $('#id_current_class').change(function() {
            var url = "{% url 'academics:ajax_load_sections' %}";
            var classId = $(this).val();

            if (classId) {
                $.ajax({
                    url: url,
                    data: {
                        'class_id': classId
                    },
                    success: function(data) {
                        var sectionSelect = $('#id_section');
                        sectionSelect.empty();
                        sectionSelect.append('<option value="">---------</option>');
                        
                        $.each(data, function(key, value) {
                            sectionSelect.append('<option value="' + value.id + '">' + value.name + '</option>');
                        });
                        
                        // Trigger change to update Select2 if needed, though usually standard options work fine
                        // sectionSelect.trigger('change');
                    }
                });
            } else {
                $('#id_section').html('<option value="">---------</option>');
            }
        });
    });
</script>
{% endblock %}

{% endblock %}
